function isMoodlePage() {
  return (
    document.getElementById("region-main") ||
    document.querySelector(".moodle-body") ||
    (typeof M !== "undefined" && M.cfg && M.cfg.wwwroot) ||
    document.querySelector('meta[name="generator"][content*="Moodle"]') ||
    window.location.href.includes("/moodle/") ||
    window.location.href.includes("moodle")
  );
}

if (isMoodlePage()) {
  //   console.log("This is a Moodle page");

  (function () {
    // Function to load a script
    function loadScript(src) {
      return new Promise((resolve, reject) => {
        const script = document.createElement("script");
        script.src = src;
        script.onload = () => resolve(script);
        script.onerror = () =>
          reject(new Error(`Failed to load script: ${src}`));
        document.head.appendChild(script);
      });
    }

    // Function to load a stylesheet
    function loadStylesheet(href) {
      const link = document.createElement("link");
      link.rel = "stylesheet";
      link.href = href;
      document.head.appendChild(link);
    }

    // Function to initialize the chatbot
    function initChatbot($) {
      // Your chatbot initialization code here using $
      $("*[include-html]").each(function () {
        const tt_1 = $(this).attr("include-html"),
          uu_1 = this.id;

        $.ajax({
          url: tt_1,
          success: function (response) {
            $("#" + uu_1).html(response);
            setTimeout(() => {
              loadScript(
                "https://insights.elishatelecom.com/aichat/public/snippet_assets/js/chatbot-functions.js"
              );
            }, 1000);
          },
          error: function (n, c, i) {
            const s = n.status + ": " + n.statusText;
            $("#" + uu_1).html(s);
          },
        });
      });
    }

    // Function to wait for RequireJS to be available
    function waitForRequireJS() {
      return new Promise((resolve) => {
        (function checkRequire() {
          if (
            typeof require !== "undefined" &&
            typeof require.config === "function"
          ) {
            resolve();
          } else {
            setTimeout(checkRequire, 1000);
          }
        })();
      });
    }

    // Load the scripts and stylesheets after RequireJS is ready
    waitForRequireJS().then(() => {
      window.addEventListener("load", function () {
        var script = document.createElement("script");
        var script2 = document.createElement("script");
        var script3 = document.createElement("script");
        var script4 = document.createElement("script");

        script.src =
          "https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js";
        script2.src =
          "https://insights.elishatelecom.com/aichat/public/snippet_assets/autolinker/Autolinker.min.js";
        script3.src =
          "https://insights.elishatelecom.com/aichat/public/snippet_assets/js/Chatbot.min.js";
        script4.src =
          "https://insights.elishatelecom.com/aichat/public/snippet_assets/js/chatbot-functions.js";

        // append the script element to the HTML head
        document.head.appendChild(script);

        var link = document.createElement("link");
        var link2 = document.createElement("link");
        var link3 = document.createElement("link");
        var link4 = document.createElement("link");
        var link5 = document.createElement("link");

        link.rel = "stylesheet";
        link.type = "text/css";
        link.href =
          "https://insights.elishatelecom.com/aichat/public/snippet_assets/styles/responsive.css";

        link2.rel = "stylesheet";
        link2.type = "text/css";
        link2.href =
          "https://fonts.googleapis.com/css2?family=Roboto&display=swap";

        link3.rel = "stylesheet";
        link3.href =
          "https://fonts.googleapis.com/css2?family=Lato:wght@100&display=swap";

        link4.rel = "stylesheet";
        link4.href =
          "https://unicons.iconscout.com/release/v4.0.0/css/line.css";

        // link5.rel = 'stylesheet';
        // link5.href = 'https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css';
        // link5.crossorigin = 'anonymous'

        script.onload = function () {
          var jQueryAlias = $.noConflict(true);
          (function ($) {
            // jQuery is now loaded and can be used
            $(document).ready(function () {
              $("*[include-html]").each(function () {
                var tt_1 = $(this).attr("include-html"),
                  uu_1 = this.id;

                $.ajax({
                  url: tt_1,
                  success: function (tt_1) {
                    $("#" + uu_1).html(tt_1);
                    document.head.appendChild(script2);
                    document.head.appendChild(script3);

                    document.head.appendChild(script4);
                  },
                  error: function (n, c, i) {
                    var s = n.status + ": " + n.statusText;
                    $("#" + uu_1).html(tt_1 + "-" + s);
                  },
                });
              });
            });
          })(jQueryAlias);
        };
      });
    });
  })();
} else {
  // console.log("This is not a Moodle page");

  var script = document.createElement("script");
  var script2 = document.createElement("script");
  var script3 = document.createElement("script");
  var script4 = document.createElement("script");

  script.src =
    "https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js";
  script2.src =
    "https://insights.elishatelecom.com/aichat/public/snippet_assets/autolinker/Autolinker.min.js";
  script3.src =
    "https://insights.elishatelecom.com/aichat/public/snippet_assets/js/Chatbot.min.js";
  script4.src =
    "https://insights.elishatelecom.com/aichat/public/snippet_assets/js/chatbot-functions.js";

  // append the script element to the HTML head
  document.head.appendChild(script);
  document.head.appendChild(script2);
  document.head.appendChild(script3);

  var link = document.createElement("link");
  var link2 = document.createElement("link");
  var link3 = document.createElement("link");
  var link4 = document.createElement("link");
  var link5 = document.createElement("link");

  link.rel = "stylesheet";
  link.type = "text/css";
  link.href =
    "https://insights.elishatelecom.com/aichat/public/snippet_assets/styles/responsive.css";

  link2.rel = "stylesheet";
  link2.type = "text/css";
  link2.href = "https://fonts.googleapis.com/css2?family=Roboto&display=swap";

  link3.rel = "stylesheet";
  link3.href =
    "https://fonts.googleapis.com/css2?family=Lato:wght@100&display=swap";

  link4.rel = "stylesheet";
  link4.href = "https://unicons.iconscout.com/release/v4.0.0/css/line.css";

  // link5.rel = 'stylesheet';
  // link5.href = 'https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css';
  // link5.crossorigin = 'anonymous'

  document.head.appendChild(link);
  document.head.appendChild(link2);
  document.head.appendChild(link3);
  document.head.appendChild(link4);
  // document.head.appendChild(link5);

  // wait for the script to load
  script.onload = function () {
    var jQueryAlias = $.noConflict(true);
    (function ($) {
      // jQuery is now loaded and can be used
      $(document).ready(function () {
        $("*[include-html]").each(function () {
          var tt_1 = $(this).attr("include-html"),
            uu_1 = this.id;

          $.ajax({
            url: tt_1,
            success: function (tt_1) {
              $("#" + uu_1).html(tt_1);
              document.head.appendChild(script4);
            },
            error: function (n, c, i) {
              var s = n.status + ": " + n.statusText;
              $("#" + uu_1).html(tt_1 + "-" + s);
            },
          });
        });
      });
    })(jQueryAlias);
  };
}
// var script = document.createElement('script');
// var script2 = document.createElement('script');
// var script3 = document.createElement('script');
// var script4 = document.createElement('script');

// script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js';
// script2.src = 'https://eacomm.com/assets/autolinker/Autolinker.min.js';
// script3.src = 'https://eacomm.com/assets/js/Chatbot.min.js';
// script4.src = 'https://eacomm.com/assets/js/chatbot-functions.js';

// // append the script element to the HTML head
// document.head.appendChild(script);
// document.head.appendChild(script2);
// document.head.appendChild(script3);

// var link = document.createElement('link');
// var link2 = document.createElement('link');
// var link3 = document.createElement('link');
// var link4 = document.createElement('link');
// var link5 = document.createElement('link');

// link.rel = 'stylesheet';
// link.type = 'text/css';
// link.href = 'https://eacomm.com/assets/styles/responsive.css';

// link2.rel = 'stylesheet';
// link2.type = 'text/css';
// link2.href = 'https://fonts.googleapis.com/css2?family=Roboto&display=swap';

// link3.rel = 'stylesheet';
// link3.href = 'https://fonts.googleapis.com/css2?family=Lato:wght@100&display=swap';

// link4.rel = 'stylesheet';
// link4.href = 'https://unicons.iconscout.com/release/v4.0.0/css/line.css';

// // link5.rel = 'stylesheet';
// // link5.href = 'https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css';
// // link5.crossorigin = 'anonymous'

// document.head.appendChild(link);
// document.head.appendChild(link2);
// document.head.appendChild(link3);
// document.head.appendChild(link4);
// // document.head.appendChild(link5);

// // wait for the script to load
// script.onload = function() {
//     var jQueryAlias = $.noConflict(true);
//     (function($) {

//   // jQuery is now loaded and can be used
//   $(document).ready(function() {
//     $("*[include-html]").each(function() {
//             var tt_1 = $(this).attr("include-html"),
//                 uu_1 = this.id;

//                 $.ajax({
//                 url: tt_1,
//                 success: function(tt_1){
//                     $("#" + uu_1).html(tt_1)
//                     document.head.appendChild(script4);
//                 },
//                 error: function(n, c, i){
//                     var s = n.status + ": " + n.statusText;
//                     $("#" + uu_1).html(tt_1 + "-" + s)
//                 }
//             })
//         })
//     })
//   })(jQueryAlias);
// };

// function loadScript(src) {
//   return new Promise((resolve, reject) => {
//     const script = document.createElement("script");
//     script.src = src;
//     script.onload = () => resolve(script);
//     script.onerror = () => reject(new Error(`Failed to load script: ${src}`));
//     document.head.appendChild(script);
//   });
// }

// // Function to load a stylesheet
// function loadStylesheet(href) {
//   const link = document.createElement("link");
//   link.rel = "stylesheet";
//   link.href = href;
//   document.head.appendChild(link);
// }

// // Function to initialize the chatbot
// function initChatbot($) {
//   // Your chatbot initialization code here using $

//   $("*[include-html]").each(function () {
//     const tt_1 = $(this).attr("include-html"),
//       uu_1 = this.id;

//     $.ajax({
//       url: tt_1,
//       success: function (response) {
//         $("#" + uu_1).html(response);
//          setTimeout(() => {
//         loadScript("https://eacomm.com/assets/js/chatbot-functions.js");
//       }, 1000);
//       },
//       error: function (n, c, i) {
//         const s = n.status + ": " + n.statusText;
//         $("#" + uu_1).html(s);
//       },
//     });
//   });
// }

// // Wait for the window load event to ensure all resources are loaded
// window.addEventListener("load", function () {
//   // Load jQuery specifically for the chatbot
//   Promise.all([
//     loadScript(
//       "https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"
//     ),
//     loadScript("https://eacomm.com/assets/autolinker/Autolinker.min.js"),
//     loadScript("https://eacomm.com/assets/js/Chatbot.min.js"),
//     loadStylesheet("https://eacomm.com/assets/styles/responsive.css"),
//     loadStylesheet(
//       "https://fonts.googleapis.com/css2?family=Roboto&display=swap"
//     ),
//     loadStylesheet(
//       "https://fonts.googleapis.com/css2?family=Lato:wght@100&display=swap"
//     ),
//     loadStylesheet("https://unicons.iconscout.com/release/v4.0.0/css/line.css"),
//   ])
//     .then(([jqueryScript, autolinkerScript, chatbotScript]) => {
//         const jQuery341 = jQuery.noConflict(true); // Use jQuery 3.4.1 specifically for chatbot
//         initChatbot(jQuery341); // Initialize chatbot using jQuery 3.4.1

//     })

//     .catch((error) => console.error(error));
// });